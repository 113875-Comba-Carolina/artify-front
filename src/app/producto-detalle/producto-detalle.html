<!-- Header -->
<div class="producto-header">
  <div class="container">
    <button (click)="goBack()" class="back-button">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
      </svg>
      Volver
    </button>
  </div>
</div>

<!-- Loading State -->
@if (isLoading) {
  <div class="loading-container">
    <div class="loading-spinner"></div>
    <p class="loading-text">Cargando producto...</p>
  </div>
}

<!-- Error State -->
@if (error) {
  <div class="error-container">
    <div class="error-content">
      <svg class="error-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
      </svg>
      <h3 class="error-title">Error al cargar producto</h3>
      <p class="error-message">{{ error }}</p>
      <button (click)="loadProducto()" class="retry-button">
        Intentar de nuevo
      </button>
    </div>
  </div>
}

<!-- Producto Detalle -->
@if (!isLoading && !error && producto) {
  <div class="producto-detalle-container">
    <div class="container">
      <div class="producto-detalle-grid">
        <!-- Imagen del producto -->
        <div class="producto-imagen-section">
          <div class="producto-imagen-container">
            @if (producto.imagenUrl) {
              <img [src]="producto.imagenUrl" [alt]="producto.nombre" class="producto-imagen">
            } @else {
              <div class="producto-placeholder">
                <svg class="w-24 h-24 text-artisan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L12 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                </svg>
              </div>
            }
            @if (!producto.esActivo) {
              <div class="producto-status inactive">
                <span>No disponible</span>
              </div>
            }
          </div>
        </div>

        <!-- Información del producto -->
        <div class="producto-info-section">
          <div class="producto-info-card">
            <!-- Categoría -->
            <div class="producto-categoria">
              <img [src]="getCategoriaIcon(producto.categoria)" [alt]="getCategoriaNombre(producto.categoria)" class="categoria-icon">
              <span class="categoria-nombre">{{ getCategoriaNombre(producto.categoria) }}</span>
            </div>

            <!-- Nombre -->
            <h1 class="producto-nombre">{{ producto.nombre }}</h1>

            <!-- Precio -->
            <div class="producto-precio">
              <span class="precio">{{ formatPrice(producto.precio) }}</span>
              @if (producto.stock > 0) {
                <span class="stock">Stock: {{ producto.stock }}</span>
              } @else {
                <span class="stock out">Sin stock</span>
              }
            </div>

            <!-- Descripción -->
            <div class="producto-descripcion">
              <h3>Descripción</h3>
              <p>{{ producto.descripcion }}</p>
            </div>

            <!-- Cantidad -->
            @if (producto.esActivo && producto.stock > 0 && !isArtesanoDelProducto) {
              <div class="cantidad-section">
                <label class="cantidad-label">Cantidad:</label>
                <div class="cantidad-controls">
                  <button 
                    (click)="onDecrementarCantidad()" 
                    [disabled]="cantidad <= 1"
                    class="cantidad-btn"
                  >
                    -
                  </button>
                  <input 
                    type="number" 
                    [(ngModel)]="cantidad"
                    (ngModelChange)="onCantidadChange()"
                    [max]="maxCantidad"
                    min="1"
                    class="cantidad-input"
                  >
                  <button 
                    (click)="onIncrementarCantidad()" 
                    [disabled]="cantidad >= maxCantidad"
                    class="cantidad-btn"
                  >
                    +
                  </button>
                </div>
                <span class="cantidad-max">Máximo: {{ maxCantidad }}</span>
              </div>
            }

            <!-- Botones de acción -->
            @if (!isArtesanoDelProducto) {
              <div class="producto-actions">
                <button 
                  class="buy-button"
                  [disabled]="!producto.esActivo || producto.stock === 0"
                  (click)="onComprar()"
                >
                  Comprar ahora
                </button>
                
                <button 
                  class="cart-button"
                  [disabled]="!producto.esActivo || producto.stock === 0"
                  (click)="onAgregarAlCarrito()"
                >
                  Agregar al carrito
                </button>
              </div>
            } @else {
              <div class="artesano-message">
                <div class="message-content">
                  <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                  </svg>
                  <p>Este es tu producto. Puedes editarlo desde tu panel de gestión.</p>
                </div>
              </div>
            }
          </div>
        </div>
      </div>

      <!-- Información del artesano -->
      @if (producto.artesano) {
        <div class="artesano-section">
          <div class="artesano-card">
            <h3 class="artesano-title">Información del Artesano</h3>
            <div class="artesano-content">
              <div class="artesano-avatar">
                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                </svg>
              </div>
              <div class="artesano-info">
                <h4 class="artesano-nombre">{{ producto.artesano.nombreEmprendimiento || producto.artesano.nombre }}</h4>
                <p class="artesano-email">{{ producto.artesano.email }}</p>
                @if (producto.artesano.ubicacion) {
                  <p class="artesano-ubicacion">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                    </svg>
                    {{ producto.artesano.ubicacion }}
                  </p>
                }
                @if (producto.artesano.descripcion) {
                  <p class="artesano-descripcion">{{ producto.artesano.descripcion }}</p>
                }
              </div>
            </div>
          </div>
        </div>
      }
    </div>
  </div>
}
