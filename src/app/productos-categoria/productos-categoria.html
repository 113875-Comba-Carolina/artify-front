<!-- Header -->
<div class="categoria-header">
  <div class="container">
    <div class="header-content">
      <button (click)="goBack()" class="back-button">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
        </svg>
        Volver al Inicio
      </button>
      
      <div class="categoria-info">
        <div class="categoria-icon">
          <img [src]="getCategoriaIcon(categoria)" [alt]="categoriaNombre" class="w-12 h-12">
        </div>
        <div>
          <h1 class="categoria-title">{{ categoriaNombre }}</h1>
          <p class="categoria-subtitle">{{ productos.length }} productos disponibles</p>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Buscador -->
<div class="search-section">
  <div class="container">
    <div class="search-container">
      <svg class="search-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
      </svg>
      <input 
        type="text" 
        placeholder="Buscar productos, artesanos..." 
        [(ngModel)]="searchTerm"
        (input)="onSearchChange()"
        class="search-input"
      >
      <button 
        *ngIf="searchTerm" 
        (click)="clearSearch()" 
        class="clear-search-btn"
        title="Limpiar búsqueda"
      >
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>
  </div>
</div>

<!-- Loading State -->
@if (isLoading) {
  <div class="loading-container">
    <div class="loading-spinner"></div>
    <p class="loading-text">Cargando productos...</p>
  </div>
}

<!-- Error State -->
@if (error) {
  <div class="error-container">
    <div class="error-content">
      <svg class="error-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
      </svg>
      <h3 class="error-title">Error al cargar productos</h3>
      <p class="error-message">{{ error }}</p>
      <button (click)="loadProductos()" class="retry-button">
        Intentar de nuevo
      </button>
    </div>
  </div>
}

<!-- Empty State -->
@if (!isLoading && !error && productosFiltrados.length === 0) {
  <div class="empty-container">
    <div class="empty-content">
      <svg class="empty-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"></path>
      </svg>
      <h3 class="empty-title">No hay productos disponibles</h3>
      <p class="empty-message">
        @if (searchTerm) {
          No se encontraron productos que coincidan con "{{ searchTerm }}"
        } @else {
          Aún no hay productos en la categoría {{ categoriaNombre }}
        }
      </p>
      @if (searchTerm) {
        <button (click)="clearSearch()" class="clear-search-button">
          Limpiar búsqueda
        </button>
      }
    </div>
  </div>
}

<!-- Productos Grid -->
@if (!isLoading && !error && productosFiltrados.length > 0) {
  <div class="productos-container">
    <div class="container">
      <div class="productos-grid">
        @for (producto of productosFiltrados; track producto.id) {
          <div class="producto-card" (click)="onVerDetalles(producto)">
            <!-- Imagen del producto -->
            <div class="producto-image">
              @if (producto.imagenUrl) {
                <img [src]="producto.imagenUrl" [alt]="producto.nombre" class="producto-img">
              } @else {
                <div class="producto-placeholder">
                  <svg class="w-12 h-12 text-artisan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L12 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                  </svg>
                </div>
              }
              @if (!producto.esActivo) {
                <div class="producto-status inactive">
                  <span>No disponible</span>
                </div>
              }
            </div>

            <!-- Información del producto -->
            <div class="producto-info">
              <h3 class="producto-nombre">{{ producto.nombre }}</h3>
              <p class="producto-descripcion">{{ producto.descripcion }}</p>
              
              <div class="producto-precio">
                <span class="precio">{{ formatPrice(producto.precio) }}</span>
                @if (producto.stock > 0) {
                  <span class="stock">Stock: {{ producto.stock }}</span>
                } @else {
                  <span class="stock out">Sin stock</span>
                }
              </div>
            </div>

            <!-- Información del artesano -->
            <div class="artesano-info">
              <div class="artesano-header">
                <div class="artesano-avatar">
                  <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                  </svg>
                </div>
                <div class="artesano-details">
                  <h4 class="artesano-nombre">{{ producto.artesano?.nombreEmprendimiento || producto.artesano?.nombre || 'Artesano' }}</h4>
                  <p class="artesano-email">{{ producto.artesano?.email || 'Email no disponible' }}</p>
                </div>
              </div>
              
              @if (producto.artesano?.ubicacion) {
                <div class="artesano-contact">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                  </svg>
                  <span>{{ producto.artesano?.ubicacion }}</span>
                </div>
              }
              
              @if (producto.artesano?.descripcion) {
                <div class="artesano-contact">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                  </svg>
                  <span>{{ producto.artesano?.descripcion }}</span>
                </div>
              }
            </div>

            <!-- Acciones -->
            <div class="producto-actions">
              <div class="action-buttons">
                <button 
                  class="buy-button"
                  [disabled]="!producto.esActivo || producto.stock === 0"
                  (click)="onComprar($event, producto)"
                  title="Comprar producto"
                >
                  Comprar
                </button>
                
                <button 
                  class="cart-button"
                  [disabled]="!producto.esActivo || producto.stock === 0"
                  (click)="onAgregarAlCarrito($event, producto)"
                  title="Agregar al carrito"
                >
                  Agregar al Carrito
                </button>
              </div>
            </div>
          </div>
        }
      </div>
    </div>
  </div>
}
